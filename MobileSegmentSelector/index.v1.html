<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <title>Super Segment Style (position E)</title>
        
    <style>
        img {
            width: 60px;
            height: 10px;
            position: absolute;
            left: 725px;
            margin-top: -20px;
        }
        
        .idTA {
            margin-top: -50px;   
        }
        textarea {
            width: 480px;
            height: 50px;
            }
    	div + div:not(.containing-element) {
    		width: 810px;
    		}
    	input {
    		width: 476px;
    		}
    	.title {
            width: 230px;
    		float: left;
    		}
    		}
        .checkbox input {
            width: 15px;
            }
    	#submitBtn,#clearBtn,#previewBtn {
    		width: 100px;
    		color: white;
    		border: 1px solid black;
    		background-color: green;
    		}
    	#output {
    		overflow: auto;
    		width: 640px;
            height: 300px;
    		padding: 10px;
    		border: 1px dashed silver;
    		}
        .containing-element .ui-slider-switch { 
            width: 10em;
            }
        .flip {
            width: 95px;
            }
    </style>
        
    <script src="../jquery.js" type="text/javascript"></script>
        
    <script>
        var version = "superStyleE";
        var params={};window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(str,key,value){params[key] = value;});
        
    	function el(s) {
    		return document.getElementById(s)
    	};
        
        function init() {
            if (version == "superStyleE") {
                var adOutput = '<script type="text/javascript">';
                
                adOutput += '\n(function(window, undefined) {';
                adOutput += '\n' + 'window.top.postMessage(JSON.stringify({';
                adOutput += '\n\t' + '"id": "mDotStyleSponsored",';
                
                // vehicleStyle
                adOutput += '\n\t' + '"'+superStyleEFields[0].tag+'": "' + el(superStyleEFields[0].id).value + '",';
                
                // imgURL
                adOutput += '\n\t' + '"'+superStyleEFields[1].id+'": "' + el(superStyleEFields[1].id).value + '",';
                
                adOutput += '\n\t' + '}),window.location.href);';
                adOutput += '\n' + '})(window);';
                adOutput += '\n' + '<\/script>';
                
                // impresssion tracker
                adOutput += '\n' + unHTMLEntities(el(superStyleEFields[2].id).value);
            } 
            
                        
            if (formCompetion() != false){
                output = adOutput;
                el("output").innerHTML = output;
            } else {
                el("output").innerHTML = "Fill out all the fields to generate the tag";   
            }
        }
        
        function formCompetion(){
            fields = superStyleEFields;
            console.clear();
            var filledOut = 0;
            
            for (i=0; i<fields.length; i++){
                filledOut += fieldCheck(fields[i].id);
                //console.log(fields[i].id + ": " + el(fields[i].id).value + " ||| " + filledOut + "\n");
            }
            
            //console.log( filledOut == fields.length ? version : false );
            return (filledOut == fields.length ? version : false);
        }
        
        function fieldCheck(s){
            var v = 0;
            // check for empty inputs
            var e = el(s).value.replace(/\s/g, "")
            if (e != "")
                v = 1;
            
            // exempt from field check
            //if (s == "vidUrl" || s == "vidTriggerUrl" || s == "tracking")
            //    v = 1;
            
            return v;
        }
        
        function clearform(){
            fields = superStyleEFields;
            console.clear();
            el("output").innerHTML = "";
            
            //console.log (fields.length);
            for (i=0; i<fields.length; i++){
                el(fields[i].id).value = "";   
            }
        }
        
        var superStyleEFields = [
        /* 0 */    {id: "vehicleStyle", title: "Vehicle Style", tag: "vehicleStyle", type: ""},
        /* 1 */    {id: "imgURL", title: "Image URL (45x20 Facing Right)", tag: "imgURL", type: "id_image.png"},
        /* 2 */    {id: "tracking", title: "Tracking Tags", tag: "tracking", type: "id_tag.png"}   
        ];
        
        var styleSelect = [
            {code: "AWD4WD", display: "AWD & 4WD"},
            {code: "COMMERCIAL", display: "Commercial"},
            {code: "CONVERT", display: "Convert"},
            {code: "COUPE", display: "Coupe"},
            {code: "HATCH", display: "Hatch"},
            {code: "HYBEL", display: "Hybrid"},
            {code: "LUXURY", display: "Luxury"},
            {code: "SEDAN", display: "Sedan"},
            {code: "SUVCROSS", display: "SUV & Crossover"},
            {code: "TRUCKS", display: "Truck"},
            {code: "VANMV", display: "Van & Minivan"},
            {code: "WAGON", display: "Wagon"}
        ];
        
        function buildForm() {
            var formOutput = "";
            if (version == "superStyleE") {
                for (i=0; i<superStyleEFields.length; i++){
                    if (superStyleEFields[i].id == "tracking"){
                        formOutput += "<div><div class=\"title\">"+superStyleEFields[i].title+": </div><div><textarea id=\""+superStyleEFields[i].id+"\" ></textarea></div> <div><img class='idTA' src='../"+ superStyleEFields[i].type +"' /></div> </div>\n";
                    } else if (superStyleEFields[i].id == "vehicleStyle") {
                        formOutput += "<div><div class=\"title\">"+superStyleEFields[i].title+": </div><div class=\"input\"><select id=\""+superStyleEFields[i].id+"\"></div></div>\n";
                        for (j=0; j<styleSelect.length; j++){
                            formOutput += "<option value=\""+styleSelect[j].code+"\">"+styleSelect[j].display+"</option>"
                        }
                        formOutput += "</select>";
                    } else {
                        formOutput += "<div><div class=\"title\">"+superStyleEFields[i].title+": </div><div class=\"input\"><input id=\""+superStyleEFields[i].id+"\" type=text /></div> <div><img src='../"+ superStyleEFields[i].type +"' /></div> </div>\n";
                    }
                }
            } 
            
            el("formDiv").innerHTML = formOutput;
            
            // default values for testing
            if (params["test"]){
                el("vehicleStyle").value = "SUVCROSS";
                el("imgURL").value = "//content.autotrader.com/content/dam/autotrader/ads/mobile/style/2015/ram/Ram-90x40.png";
                el("tracking").value = '<script src="https://cdn.doubleverify.com/dvtp_src.js?ctx=716153&cmp=8431130&sid=233408&plc=113991667&num=%%CACHEBUSTER%%&adid=&advid=2742104&adsrv=1&region=30&btreg=&btadsrv=&crt=&crtname=&chnl=&unit=&pid=&uid=&tagtype=&dvtagver=6.1.src" type="text/javascript"><\/script><img src="https://ford.demdex.net/event?d_src=27725&d_event=imp&d_bu=3971545&d_creative=888888888&d_adgroup=888888888&d_placement=113991667&d_site=233408&d_campaign=8431130&d_cb=%%CACHEBUSTER%%" width=\'1\' height=\'1\' border=\'0\'/><img src=\'https://h.nexac.com/e/a-1659/s-3508/c-840/g-3041.xgi?pkey=bijo15bijox40&chpcm=8431130&chpsg=233408&chpcr=99999999&chpck=999999999&rand=%%CACHEBUSTER%%&chpth=113991667\' width=\'1\' height=\'1\' border=\'0\'>';

            }
        }
        
        function unHTMLEntities(s) {
            var strArr = s.split("&");
            console.log( strArr.join("&amp;") );            
            return strArr.join("&AMP;");
        }
        
        $( buildForm );
    </script>
    
    </head>
    <body>
    	<form name="adBuilder">
            <div>
            
            <div id="formDiv"></div>
            
    		
    		<div>
                <br />
                <input id="submitBtn" type=button value="Generate Tag" onmousedown="init();" />
                <input id="clearBtn" type=button value="Clear Form" onmousedown="clearform();" />
            </div>
        </form>
    	
    	<p>
    		<textarea id="output"></textarea>
    	</p>
    </body>
</html>