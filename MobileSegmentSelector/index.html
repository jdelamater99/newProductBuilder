<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <title>Super Segment Style (position E)</title>
        
    <link type="text/css" href="../bin/builder.css" rel="stylesheet" />
        
    <script src="../bin/jquery.js" type="text/javascript"></script>
    <script src="../bin/builderFunctions.js" type="text/javascript"></script>
        
    <script>
        // exempt from field check
        var excludes = ["impressionTag2"];
        
        function init() {
            var adOutput = '<!-- MOBILE: STYLE SPONSOR -->';
            adOutput += '\n' + '<IMG SRC="' + el(pageFormFields[1].id).value + '" BORDER=0 WIDTH=1 HEIGHT=1 ALT="Advertisement">';
            adOutput += '\n' + '<script type="text/javascript">';

            adOutput += '\n\n' + '(function(window, undefined) {';
            adOutput += '\n' + 'window.top.postMessage(JSON.stringify({';
            adOutput += '\n\t' + '"id": "mDotStyleSponsored",';

            // vehicleStyle
            adOutput += '\n\t' + '"'+pageFormFields[0].tag+'": "' + el(pageFormFields[0].id).value.toLowerCase() + '",';

            // imgURL
            adOutput += '\n\t' + '"'+pageFormFields[2].id+'": "' + el(pageFormFields[2].id).value + '",';

            // text lines
            adOutput += '\n\t' + '"'+pageFormFields[3].id+'": "' + el(pageFormFields[3].id).value + '",';
            adOutput += '\n\t' + '"'+pageFormFields[4].id+'": "' + el(pageFormFields[4].id).value + '",';
            adOutput += '\n\t' + '"'+pageFormFields[5].id+'": "%%CLICK_URL_ESC%%' + el(pageFormFields[5].id).value + '"';

            adOutput += '\n' + '}),window.location.href);';
            adOutput += '\n\n' + '})(window);';
            adOutput += '\n\n' + '<\/script>';
            
                        
            if (formCompetion() != false){
                output = unHTMLEntities(adOutput);
                el("output").innerHTML = output;
            } else {
                el("output").innerHTML = "Fill out all the fields to generate the tag and make sure no prepopulated data remains.";   
            }
        }
        
        var pageFormFields = [
        /* 0 */    {id: "vehicleStyle", title: "Vehicle Style", tag: "vehicleStyle", type: ""},
        /* 1 */    {id: "impressionTracker", title: "Impression Tracker", tag: "impressionTracker", type: "bin/id_image.png"},
        /* 2 */    {id: "imgURL", title: "Image URL (45x20 Facing Right)", tag: "imgURL", type: "bin/id_image.png"},
        /* 3 */    {id: "styleLabelLine1", title: "Line 1", tag: "styleLabelLine1", type: "bin/id_text.png"},
        /* 4 */    {id: "styleLabelLine2", title: "Line 2", tag: "styleLabelLine2", type: "bin/id_text.png"},
        /* 5 */    {id: "searchURL", title: "Search URL", tag: "searchURL", type: "bin/id_URL.png"}
        ];
        
        var styleSelect = [
            {code: "--------", display: "--------"},
            {code: "AWD4WD", display: "AWD & 4WD"},
            {code: "COMMERCIAL", display: "Commercial"},
            {code: "CONVERT", display: "Convert"},
            {code: "COUPE", display: "Coupe"},
            {code: "HATCH", display: "Hatch"},
            {code: "HYBEL", display: "Hybrid"},
            {code: "LUXURY", display: "Luxury"},
            {code: "SEDAN", display: "Sedan"},
            {code: "SUVCROSS", display: "SUV & Crossover"},
            {code: "TRUCKS", display: "Truck"},
            {code: "VANMV", display: "Van & Minivan"},
            {code: "WAGON", display: "Wagon"}
        ];
        
        var defaultValues = [
            {id: "vehicleStyle", value: "--------"},
            {id: "impressionTracker", value: "https://ad.doubleclick.net/ddm/ad/NXXXX.AutoTrader.com/BXXXXXXX.XXXXXXX.;sz=1x1;kw=[url_encoded_publisher_data];ord=[timestamp];dc_lat=;dc_rdid=;tag_for_child_directed_treatment=?"},
            {id: "imgURL", value: "https://ads.autotrader.com/adops/HTML/images/{BRAND}/segmentselector/{MODEL}.jpg"},
            {id: "styleLabelLine1", value: "Sponsored by {BRAND}"},
            {id: "styleLabelLine2", value: "2016 {BRAND} {MODEL}"},
            {id: "searchURL", value: "https://m.autotrader.com/cars-for-sale/searchresults.xhtml?priceLabel=Any&endYear=2017&pageLayout=list&startYear=2015&listingTypes=new&useGps=true&totalResultCount=97291&mmt=%5B{BRAND}%5B{MODEL}%5B%5D%5D%5B%5D%5D"}
        ];
        
        function buildForm() {
            var formOutput = "";
            if (version == "pageForm") {
                for (i=0; i<pageFormFields.length; i++){
                    // text area
                    if (pageFormFields[i].id == "tracking"){
                        formOutput += "<div><div class=\"title\">"+pageFormFields[i].title+": </div><div><textarea class='defaultInput' id=\""+pageFormFields[i].id+"\" ></textarea></div> <div><img class='idTA' src='../"+ pageFormFields[i].type +"' /></div> </div>\n";
                    // dropdown
                    } else if (pageFormFields[i].id == "vehicleStyle") {
                        formOutput += "<div><div class=\"title\">"+pageFormFields[i].title+": </div><div class=\"input\"><select class='defaultInput' id=\""+pageFormFields[i].id+"\"></div></div>\n";
                        for (j=0; j<styleSelect.length; j++){
                            formOutput += "<option value=\""+styleSelect[j].code.toLowerCase()+"\">"+styleSelect[j].display+"</option>"
                        }
                        formOutput += "</select>";
                    // input
                    } else {
                        formOutput += "<div><div class=\"title\">"+pageFormFields[i].title+": </div><div class=\"input\"><input class='defaultInput' class='defaultInput' id=\""+pageFormFields[i].id+"\" type=text /></div> <div><img src='../"+ pageFormFields[i].type +"' /></div> </div>\n";
                    }
                }
            } 
            
            el("formDiv").innerHTML = formOutput;
            
            if (params["test"]){
                for (i=0; i<defaultValues.length; i++) {
                    el(defaultValues[i].id).value = defaultValues[i].value;
                }
            }
            
            inputFocus();
            
        }
        
        $( buildForm );
    </script>
    
    </head>
    <body>
    	<form name="adBuilder">
            <div>
            
            <div id="formDiv"></div>
            
    		
    		<div>
                <br />
                <input id="submitBtn" type=button value="Generate Tag" onmousedown="init();" />
                <input id="clearBtn" type=button value="Clear Form" onmousedown="clearform();" />
            </div>
        </form>
    	
    	<p>
    		<textarea id="output"></textarea>
    	</p>
    </body>
</html>